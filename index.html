<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Peter Lian Portfolio</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <link rel="apple-touch-icon" sizes="180x180" href="public/external/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="public/external/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="public/external/favicon-16x16.png" />
  <link rel="manifest" href="site.webmanifest" />

  <style>
    :root{
      --bg0:#0b1f27;
      --bg1:#0d2630;
      --ink:#0d2630;

      --teal:#26bad7;
      --mint:#a8e6cf;
      --deep:#063842;
      --muted:#5a7c81;

      --paper:#f5f2e8;
      --card:#ffffff;

      --shadow: 0 18px 40px rgba(0,0,0,0.22);
      --softShadow: 0 14px 26px rgba(0,0,0,0.12);
      --ring: 0 0 0 3px rgba(38,186,215,0.3);

      --ph0:#0d2630;
      --ph1:#26bad7;
    }

    *{ margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
    html{ scroll-behavior:smooth; }
    body{
      color:#fff;
      line-height:1.6;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(38, 186, 215, 0.18), transparent 55%),
        radial-gradient(1000px 500px at 80% 20%, rgba(168, 230, 207, 0.14), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg0), var(--bg1));
      background-size:120% 120%;
      animation:bgFloat 18s ease-in-out infinite;
      overflow-x:hidden;
    }
    @keyframes bgFloat{
      0%{ background-position:0% 0%; }
      50%{ background-position:100% 80%; }
      100%{ background-position:0% 0%; }
    }

    #scroll-progress{
      position:fixed; top:0; left:0;
      height:4px; width:0%;
      z-index:9999;
      background:linear-gradient(90deg, var(--teal), var(--mint));
      box-shadow:0 0 18px rgba(38,186,215,0.35);
      border-bottom-right-radius:999px;
      border-top-right-radius:999px;
      transform:translateZ(0);
    }

    @media (prefers-reduced-motion: reduce){
      html { scroll-behavior:auto; }
      body { animation:none; }
      *{ animation-duration:0.001ms !important; animation-iteration-count:1 !important; transition-duration:0.001ms !important; }
    }

    .container{ max-width:1200px; margin:0 auto; padding:0 20px; }

    header{
      display:flex; justify-content:space-between; align-items:center;
      padding:18px 16px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius:18px;
      margin-top:18px;
      opacity:0; transform:translateY(10px);
      animation: fadeUp 700ms ease forwards;
      gap:12px;
      flex-wrap:wrap;
    }
    @keyframes fadeUp{ to{ opacity:1; transform:translateY(0); } }

    .logo{
      font-size:24px; font-weight:bold;
      background:linear-gradient(90deg, #ffffff 0%, var(--teal) 35%, #ffffff 70%);
      background-size:220% 100%;
      -webkit-background-clip:text; background-clip:text;
      color:transparent;
      animation: logoShimmer 3.2s ease-in-out infinite;
      letter-spacing:0.2px;
      white-space:nowrap;
    }
    @keyframes logoShimmer{
      0%{ background-position:0% 0%; }
      50%{ background-position:100% 0%; }
      100%{ background-position:0% 0%; }
    }

    .social-icons{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
      margin-left:auto;
    }
    .social-icons a{
      color:#fff;
      font-size:18px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:38px; height:38px;
      border-radius:12px;
      transition: transform 180ms ease, box-shadow 180ms ease, background 180ms ease;
    }
    .social-icons a:hover{
      transform: translateY(-3px);
      background: rgba(38,186,215,0.16);
      box-shadow: 0 10px 26px rgba(0,0,0,0.25), 0 0 0 1px rgba(38,186,215,0.25);
    }

    .main-content{
      background: var(--paper);
      border-radius:20px;
      margin:20px 0;
      padding:20px;
      color:#333;
      box-shadow: var(--shadow);
      border:1px solid rgba(13,38,48,0.10);
      position:relative;
      overflow:hidden;
      opacity:0; transform:translateY(12px);
      animation: fadeUp 750ms ease forwards;
      animation-delay:120ms;
    }
    .main-content::before{
      content:"";
      position:absolute;
      inset:-60px -60px auto -60px;
      height:140px;
      background: radial-gradient(circle at 20% 20%, rgba(38,186,215,0.15), transparent 60%);
      pointer-events:none;
      filter: blur(2px);
    }

    .header-row{
      display:flex;
      justify-content:space-between;
      margin-bottom:20px;
      position:relative;
      gap:14px;
      flex-wrap:wrap;
      align-items:center;
    }
    .header-row::after{
      content:"";
      position:absolute;
      left:0; right:0;
      bottom:-10px;
      height:1px;
      background:linear-gradient(90deg, transparent, rgba(13,38,48,0.25), transparent);
    }

    .section-title{
      background: var(--bg1);
      color:#fff;
      padding:10px 20px;
      border-radius:20px;
      display:inline-block;
      margin-bottom:6px;
      font-size:22px;
      font-weight:bold;
      position:relative;
      overflow:hidden;
      box-shadow: 0 10px 24px rgba(0,0,0,0.18);
      transform:translateZ(0);
    }
    .section-title::after{
      content:"";
      position:absolute;
      left:14px; right:14px;
      bottom:8px;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(38,186,215,0.85), transparent);
      transform: scaleX(0);
      transform-origin:center;
      transition: transform 220ms ease;
      opacity:0.9;
    }
    .section-title:hover::after{ transform:scaleX(1); }

    .panel{
      background: var(--mint);
      border-radius:15px;
      padding:18px;
      margin-bottom:18px;
      position:relative;
      overflow:hidden;
      background-image:
        linear-gradient(135deg, rgba(255,255,255,0.22), rgba(255,255,255,0.00)),
        repeating-linear-gradient(135deg, rgba(255,255,255,0.10) 0px, rgba(255,255,255,0.10) 2px, rgba(255,255,255,0.00) 10px, rgba(255,255,255,0.00) 14px);
      box-shadow: var(--softShadow);
      border:1px solid rgba(13,38,48,0.08);
    }
    .panel::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(600px 220px at 20% 10%, rgba(38,186,215,0.16), transparent 55%);
      pointer-events:none;
    }

    /* Controls */
    .controls{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin: 6px 0 14px;
    }

    .search{
      flex: 1 1 320px;
      display:flex;
      gap:10px;
      align-items:center;
      background: #fff;
      border:1px solid rgba(13,38,48,0.12);
      border-radius:14px;
      padding:10px 12px;
      box-shadow: 0 10px 18px rgba(0,0,0,0.06);
    }
    .search i{ color: rgba(13,38,48,0.65); }
    .search input{
      width:100%;
      border:none;
      outline:none;
      font-size:14px;
      color: var(--ink);
      background: transparent;
    }

    .chips{
      display:flex; gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex: 1 1 280px;
    }
    .chip{
      border:1px solid rgba(13,38,48,0.15);
      background: rgba(255,255,255,0.75);
      color: var(--ink);
      padding:8px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      transition: transform 140ms ease, box-shadow 140ms ease, background 140ms ease;
      user-select:none;
    }
    .chip:hover{ transform: translateY(-1px); box-shadow: 0 10px 18px rgba(0,0,0,0.08); }
    .chip.active{
      background: rgba(38,186,215,0.18);
      border-color: rgba(38,186,215,0.55);
      box-shadow: 0 0 0 3px rgba(38,186,215,0.12);
    }

    /* Grid */
    .projects-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap:16px;
      opacity:0;
      transform:translateY(12px);
      animation: fadeUp 800ms ease forwards;
      animation-delay: 220ms;
    }

    .project-card{
      background: var(--card);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 18px 36px rgba(0,0,0,0.12);
      border:1px solid rgba(13,38,48,0.08);
      position:relative;
      overflow:hidden;
      transition: transform 220ms ease, box-shadow 220ms ease, filter 220ms ease;
    }
    .project-card::before{
      content:"";
      position:absolute;
      top:-60%; left:-60%;
      width:140%; height:140%;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.50) 20%, rgba(255,255,255,0.06) 45%, transparent 70%);
      transform: translateX(-120%) rotate(12deg);
      transition: transform 550ms ease;
      pointer-events:none;
    }
    .project-card:hover::before{ transform: translateX(120%) rotate(12deg); }
    .project-card:hover{
      transform: translateY(-6px);
      box-shadow: 0 28px 60px rgba(0,0,0,0.18);
      filter: saturate(1.03);
    }

    .project-top{ display:flex; gap:12px; align-items:flex-start; }

    .logo-wrap{
      width:56px; height:56px;
      border-radius:14px;
      flex: 0 0 auto;
      overflow:hidden;
      position:relative;
      border: 1px solid rgba(38,186,215,0.28);
      box-shadow: 0 14px 28px rgba(0,0,0,0.10);
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(38,186,215,0.25), transparent 60%),
        linear-gradient(135deg, rgba(13,38,48,0.10), rgba(255,255,255,0.65));
    }
    .logo-wrap img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .logo-wrap.placeholder::after{
      content:"IMG";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      letter-spacing:1px;
      font-size:12px;
      color: rgba(13,38,48,0.55);
      background: linear-gradient(135deg, rgba(255,255,255,0.65), rgba(255,255,255,0.25));
    }

    .project-title{
      font-size:16px;
      font-weight:800;
      color: var(--ink);
      line-height:1.25;
    }
    .project-sub{
      font-size:13px;
      color: rgba(13,38,48,0.70);
      margin-top:2px;
    }
    .project-desc{
      margin-top:10px;
      font-size:14px;
      color: rgba(13,38,48,0.88);
    }

    .tags{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(6,56,66,0.06);
      border: 1px solid rgba(6,56,66,0.10);
      color: rgba(6,56,66,0.86);
    }

    .project-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      text-decoration:none;
      font-size:13px;
      font-weight:700;
      border: 1px solid rgba(13,38,48,0.14);
      background: rgba(255,255,255,0.85);
      color: var(--ink);
      transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 12px 18px rgba(0,0,0,0.10); }
    .btn.primary{
      background: var(--bg1);
      color:#fff;
      border-color: rgba(13,38,48,0.35);
    }
    .btn.primary:hover{
      background: var(--mint);
      border-color: var(--mint);
      color: var(--ink);
    }

    /* Contact */
    .contact-info form{ display:flex; flex-direction:column; gap:12px; }
    .contact-info input,
    .contact-info textarea{
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(13,38,48,0.15);
      font-size:14px;
      background: var(--mint);
      color: var(--ink);
      transition: 0.2s;
    }
    .contact-info input::placeholder,
    .contact-info textarea::placeholder{ color: rgba(13,38,48,0.6); }
    .contact-info input:focus,
    .contact-info textarea:focus{
      outline:none;
      border-color: var(--teal);
      box-shadow: var(--ring);
    }
    .contact-info button{
      background: var(--bg1);
      color:#fff;
      padding:12px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:bold;
      transition: 0.25s;
    }
    .contact-info button:hover{ background: var(--teal); transform: translateY(-1px); }

    /* Footer */
    .site-footer{
      background: var(--deep);
      color:#fff;
      padding:30px 0;
      margin-top:40px;
    }
    .footer-content{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:14px;
    }

    a{ color: var(--teal); text-decoration:none; transition: opacity 160ms ease; }
    a:hover{ opacity:0.92; }
    a:focus-visible{
      outline:3px solid rgba(38,186,215,0.75);
      outline-offset:4px;
      border-radius:10px;
    }

    @media (max-width: 768px){
      .header-row{ flex-direction:column; align-items:flex-start; }
    }

    /* =======================
       FENCING MINI GAME STYLES
       ======================= */
    .fence-game-card{
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(13,38,48,0.14);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 18px 36px rgba(0,0,0,0.12);
      position:relative;
    }
    .fence-game-top{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px 14px;
      border-bottom:1px solid rgba(13,38,48,0.10);
      background:
        linear-gradient(135deg, rgba(38,186,215,0.12), rgba(168,230,207,0.10)),
        rgba(255,255,255,0.55);
    }
    .fence-game-title{
      display:flex;
      flex-direction:column;
      gap:3px;
      color: var(--ink);
    }
    .fence-game-title b{ font-size:14px; }
    .fence-game-title span{ font-size:12px; color: rgba(13,38,48,0.70); }

    .fence-hud{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .fence-pill{
      display:flex;
      align-items:center;
      gap:6px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(13,38,48,0.14);
      background: rgba(255,255,255,0.72);
      font-size:12px;
      color: var(--ink);
      white-space:nowrap;
    }
    .fence-pill b{ color: var(--bg1); }

    .fence-arena{
      background:
        radial-gradient(900px 260px at 50% 70%, rgba(38,186,215,0.14), transparent 60%),
        linear-gradient(180deg, rgba(13,38,48,0.06), transparent 45%),
        rgba(6,56,66,0.04);
      padding:12px;
    }
    #fenceCanvas{
      width:100%;
      height:320px;
      display:block;
      border-radius:14px;
      border:1px solid rgba(13,38,48,0.12);
      background: rgba(255,255,255,0.35);
    }

    .fence-bottom{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px 14px;
      border-top:1px solid rgba(13,38,48,0.10);
    }
    .fence-controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .fence-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      border:1px solid rgba(13,38,48,0.14);
      background: rgba(255,255,255,0.85);
      color: var(--ink);
      transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
      user-select:none;
    }
    .fence-btn:hover{ transform: translateY(-1px); box-shadow: 0 12px 18px rgba(0,0,0,0.10); }
    .fence-btn.primary{
      background: var(--bg1);
      color:#fff;
      border-color: rgba(13,38,48,0.35);
    }
    .fence-btn.primary:hover{
      background: rgba(38,186,215,0.22);
      border-color: rgba(38,186,215,0.45);
      color: var(--ink);
    }

    .fence-log{
      flex:1;
      min-width:240px;
      display:flex;
      gap:10px;
      align-items:center;
      color: rgba(13,38,48,0.75);
      font-size:12px;
    }
    .fence-dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(13,38,48,0.35);
      box-shadow: 0 0 0 4px rgba(13,38,48,0.10);
      flex:0 0 auto;
    }
    .fence-dot.ok{ background: #2ecc71; box-shadow: 0 0 0 4px rgba(46,204,113,0.12); }
    .fence-dot.warn{ background: #f39c12; box-shadow: 0 0 0 4px rgba(243,156,18,0.12); }
    .fence-dot.bad{ background: #ff4d6d; box-shadow: 0 0 0 4px rgba(255,77,109,0.12); }

    .fence-kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(13,38,48,0.14);
      background: rgba(255,255,255,0.75);
      color: rgba(13,38,48,0.85);
      white-space:nowrap;
    }
  </style>
</head>

<body>
  <div id="scroll-progress" aria-hidden="true"></div>

  <div class="container">
    <header>
      <div class="logo">Peter Lian Portfolio ÂªâÁõäÁ¢©</div>

      <div class="social-icons">
        <a href="https://x.com/peterlian18774" aria-label="X / Twitter" title="X">
          <i class="fa-brands fa-x-twitter"></i>
        </a>
        <a href="https://devpost.com/lianpeter1225?ref_content=user-portfolio&ref_feature=portfolio&ref_medium=global-nav" aria-label="Devpost" title="Devpost">
          <i class="fa-solid fa-d"></i>
        </a>
        <a href="https://www.tiktok.com/@pierre.l35" aria-label="TikTok" title="TikTok">
          <i class="fa-brands fa-tiktok"></i>
        </a>
        <a href="https://www.instagram.com/peterlian64" aria-label="Instagram" title="Instagram">
          <i class="fa-brands fa-instagram"></i>
        </a>
        <a href="https://github.com/PLIAN78" aria-label="GitHub" title="GitHub">
          <i class="fa-brands fa-github"></i>
        </a>
        <a href="https://medium.com/@lianpeter1225" aria-label="Medium" title="Medium">
          <i class="fa-brands fa-medium"></i>
        </a>
        <a href="https://www.youtube.com/@ppowerstation3547" aria-label="YouTube" title="YouTube">
          <i class="fa-brands fa-youtube"></i>
        </a>
        <a href="https://www.linkedin.com/in/yishuolian/" aria-label="LinkedIn" title="LinkedIn">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </div>
    </header>

    <div class="main-content">
      <div class="header-row">
        <div class="section-title">About</div>
        <div class="panel" style="margin-bottom:0; padding:12px 14px;">
          <p style="margin:0;">
            Hi, I‚Äôm Peter Lian, I‚Äôm a Computer Science student at the University of Waterloo.
            I work across <b>ML</b>, <b>AR/XR</b>, and <b>Full-stack</b> and recently some <b>Web3 developments </b> using Solana. 
            Outside tech: varsity fencer, entrepreneur, and drone pilot. Always remember, memento mori. 
          </p>
        </div>
      </div>

      <div class="header-row">
        <div class="section-title">Story</div>
      </div>

      <div class="panel">
        <p>
          I first started doing some front-end in <a href=" https://eden.dsbn.org/"> Grade 9</a>, then shipped production UI during my co-op at Experience Driven.
          Since then, I‚Äôve been building various projects nonstop, from computer vision sports analysis to Web3 reputation systems, 
          and turning the best ideas into real products(at least trying to). 
        </p>
      </div>

      <!-- Career -->
      <div class="header-row">
        <div class="section-title">My Career</div>
      </div>

      <div class="controls">
        <div class="search" role="search">
          <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
          <input id="careerSearchInput" type="text" placeholder="Search career (e.g., co-op, Global Spark, founder)..." />
        </div>

        <div class="chips" aria-label="Career filters">
          <button class="chip active" data-career-filter="all" type="button">All</button>
          <button class="chip" data-career-filter="current" type="button">Current</button>
          <button class="chip" data-career-filter="past" type="button">Past</button>
        </div>
      </div>

      <div class="projects-grid" id="careerGrid"></div>

      <!-- Side hustles -->
      <div class="header-row" style="margin-top:22px;">
        <div class="section-title">Side Hustles</div>
      </div>
      <div class="projects-grid" id="startupGrid"></div>

      <!-- Projects -->
      <div class="header-row" style="margin-top:22px;">
        <div class="section-title">Projects</div>
      </div>

      <div class="controls">
        <div class="search" role="search">
          <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
          <input id="searchInput" type="text" placeholder="Search projects (e.g., Solana, CV, Next.js, Unity)..." />
        </div>

        <div class="chips" aria-label="Project filters">
          <button class="chip active" data-filter="all" type="button">All</button>
          <button class="chip" data-filter="hackathon" type="button">Hackathon</button>
          <button class="chip" data-filter="personal" type="button">Personal</button>
          <button class="chip" data-filter="ml" type="button">ML / CV</button>
          <button class="chip" data-filter="web3" type="button">Web3</button>
          <button class="chip" data-filter="ar" type="button">AR/XR</button>
          <button class="chip" data-filter="fullstack" type="button">Full-Stack</button>
        </div>
      </div>

      <div class="projects-grid" id="projectGrid"></div>

      <!-- =======================
           FENCING MINI GAME (NEW)
           ======================= -->
      <div class="header-row" style="margin-top:22px;">
        <div class="section-title">Fencing Mini-Game</div>
      </div>

      <div class="panel">
        <div class="fence-game-card" role="region" aria-label="Fencing mini game">
          <div class="fence-game-top">
            <div class="fence-game-title">
              <b>Reaction Duel-Lunge or Parry Based on given Prompt(React Fast!) </b>
              <span>
                Lunge: <span class="fence-kbd">Space</span> ¬∑ Parry: <span class="fence-kbd">F</span> ¬∑ First to 5
              </span>
            </div>
            <div class="fence-hud">
              <div class="fence-pill">You <b id="fgPScore">0</b></div>
              <div class="fence-pill">AI <b id="fgAScore">0</b></div>
              <div class="fence-pill">Mode <b id="fgMode">Ready</b></div>
              <div class="fence-pill">Streak <b id="fgStreak">0</b></div>
            </div>
          </div>

          <div class="fence-arena">
            <canvas id="fenceCanvas" width="1200" height="720"></canvas>
          </div>

          <div class="fence-bottom">
            <div class="fence-controls">
              <button class="fence-btn primary" id="fgLungeBtn">
                <i class="fa-solid fa-bolt" aria-hidden="true"></i> Lunge <span class="fence-kbd">Space</span>
              </button>
              <button class="fence-btn" id="fgParryBtn">
                <i class="fa-solid fa-shield" aria-hidden="true"></i> Parry <span class="fence-kbd">F</span>
              </button>
              <button class="fence-btn" id="fgResetBtn">
                <i class="fa-solid fa-rotate-right" aria-hidden="true"></i> Reset
              </button>
            </div>

            <div class="fence-log">
              <span id="fgDot" class="fence-dot"></span>
              <span id="fgLog">
                Press <span class="fence-kbd">Space</span> to lunge. If Red commits, parry <span class="fence-kbd">F</span> then riposte with <span class="fence-kbd">Space</span>.
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- =======================
           END FENCING MINI GAME
           ======================= -->

      <!-- Contact -->
      <div class="header-row" style="margin-top:22px;">
        <div class="section-title">Contact</div>
      </div>

      <div class="panel">
        <div class="contact-info">
          <form action="https://formspree.io/f/mdalerpp" method="POST">
            <input type="text" name="name" placeholder="Your name" required />
            <input type="email" name="email" placeholder="Your email" required />
            <textarea name="message" rows="4" placeholder="Your message..." required></textarea>
            <button type="submit">Send Message</button>
          </form>
        </div>
      </div>

    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-content">
      <p>¬© 2026 Peter Lian. All rights reserved.</p>

      <div style="display:flex; align-items:center; gap:10px;">
        <a href="https://cs.uwatering.com/#peterlian.com?nav=prev" style="color:#fff;">‚Üê</a>
        <a href="https://cs.uwatering.com/#peterlian.com" target="_blank" rel="noreferrer">
          <img src="https://cs.uwatering.com/icon.white.svg" alt="CS Webring" style="width:24px; height:auto; opacity:0.85;" />
        </a>
        <a href="https://cs.uwatering.com/#peterlian.com?nav=next" style="color:#fff;">‚Üí</a>
      </div>
    </div>
  </footer>

  <script>
    // Scroll progress
    (function () {
      const bar = document.getElementById('scroll-progress');
      if (!bar) return;

      const update = () => {
        const doc = document.documentElement;
        const scrollTop = doc.scrollTop || document.body.scrollTop;
        const scrollHeight = doc.scrollHeight || document.body.scrollHeight;
        const clientHeight = doc.clientHeight || window.innerHeight;
        const max = Math.max(1, scrollHeight - clientHeight);
        const pct = (scrollTop / max) * 100;
        bar.style.width = pct + '%';
      };

      update();
      window.addEventListener('scroll', update, { passive: true });
      window.addEventListener('resize', update);
    })();

    // ---------- IMAGE PLACEHOLDER RULE ----------
    // Put your images in /external/ and set `image: "external/your.png"`
    // If `image` is empty, it shows the "IMG" placeholder.

    // --------- EDIT HERE: Career items ----------
    // ‚úÖ Added `href` so Career always gets an "Open" button (no more "Links soon").
    const careers = [
      {
        title: "Software Engineer ¬∑ BuildBane",
        subtitle: "New Features Delivery",
        when: "Current",
        desc: "Shipping out various features on the platform for users.",
        image: "BB.png",
        status: "current",
        categories: ["current"],
        tags: ["Software", "Web", "Product", "Full Stack"],
        href: "https://www.buildbane.com/"
      },
      {
        title: "Software Engineer ¬∑ Global Spark",
        subtitle: "Portal design / Hack the Globe + internal apps",
        when: "Current",
        desc: "Building and shipping product features, UI, and portal experiences.",
        image: "GS.png",
        status: "current",
        categories: ["current"],
        tags: ["Software", "Web", "Product"],
        href: "https://globalspark.world/"
      },
      {
        title: "Front-End Developer ¬∑ Experience Driven (Co-op)",
        subtitle: "Production UI / front-end delivery",
        when: "Past",
        desc: "Shipped front-end features in a real team environment, production code + design polish.",
        image: "ED.png",
        status: "past",
        categories: ["past", "intern"],
        tags: ["Co-op", "Front-end"],
        href: "https://experiencedriven.ca/"
      }
    ];

    // --------- EDIT HERE: your side hustles ----------
    const startupProjects = [
      {
        title: "AI Ventura",
        subtitle: "AI education startup",
        desc: "Co-founder / marketing lead. Built a mini-startup to teach elementary students about AI.",
        image: "AV.png",
        href: "https://www.linkedin.com/company/ai-ventura",
        tags: ["Startup", "Education"]
      },
      {
        title: "MasterBlue",
        subtitle: "Drone company",
        desc: "Selling and distributing drones since 2020.",
        image: "MB.png",
        href: "https://www.facebook.com/profile.php?id=100089709436861",
        tags: ["Hardware", "Business"]
      },
      {
        title: "KrocoPrint",
        subtitle: "3D printing startup",
        desc: "Custom gadgets and prototypes through 3D printing.",
        image: "KP.png",
        href: "https://krocoprint.com/",
        tags: ["3D Printing", "Startup"]
      }
    ];

    // --------- EDIT HERE: projects ----------
    const projects = [
      {
        title: "NewsMapper",
        subtitle: "Maps + news visualization",
        desc: "Platform that connects news stories to an interactive map for context-first discovery.",
        image: "NP.png",
        kind: "personal",
        categories: ["fullstack"],
        links: {
          demo: "https://confused-lizard-ada.notion.site/NewsMapper-d6bdf72d62ee4da89aeb2e6d34145bc4",
          github: ""
        },
        tags: ["Web", "Visualization"]
      },
      {
        title: "Carify",
        subtitle: "Web3 car reputation layer",
        desc: "Claims + evidence, anchored by cryptographic hashes (Solana). Reputation you can audit.",
        image: "CXC.png",
        kind: "hackathon",
        categories: ["web3", "fullstack"],
        links: {
          demo: "https://devpost.com/software/carify-5vx3cb",
          github: "https://github.com/PLIAN78/Carify"
        },
        tags: ["Next.js", "Express", "MongoDB", "Solana", "Gemini"]
      },
      {
        title: "PuckSense",
        subtitle: "AI hockey tactical analyzer",
        desc: "Computer vision pipeline to analyze hockey play and generate insights from video.",
        image: "HTV.png",
        kind: "hackathon",
        categories: ["ml"],
        links: {
          demo: "https://devpost.com/software/pucksense",
          github: "https://github.com/PLIAN78/PuckSense"
        },
        tags: ["OpenCV", "Python", "CV", "LLM"]
      },
      {
        title: "Frefey",
        subtitle: "AI fencing video analysis",
        desc: "Frame extraction + labeling pipeline to detect first action and touches in fencing clips.",
        image: "F.png",
        kind: "personal",
        categories: ["ml"],
        links: {
          demo: "https://github.com/PLIAN78",
          github: "https://github.com/PLIAN78/Freffy"
        },
        tags: ["OpenCV", "Python", "Sports CV"]
      },
      {
        title: "IKEA AR Furniture Placer",
        subtitle: "AR/XR product experience",
        desc: "Place 3D furniture into real space using AR workflows.",
        image: "IKEA.png",
        kind: "personal",
        categories: ["ar"],
        links: {
          demo: "https://github.com/PLIAN78",
          github: "https://github.com/PLIAN78/Furniture-project-"
        },
        tags: ["Unity", "ARCore", "3D"]
      },
      {
        title: "KnowYouFans",
        subtitle: "YouTube comment summarizer",
        desc: "Summarizes comment sentiment and key themes to understand audience feedback fast.",
        image: "KYF.png",
        kind: "personal",
        categories: ["ml", "fullstack"],
        links: {
          demo: "https://knowyoufans.live/",
          github: "https://github.com/PLIAN78/KnowYouFans"
        },
        tags: ["NLP", "LLM", "Web"]
      },
      {
        title: "AutoTrust",
        subtitle: "Car trust & reputation concept",
        desc: "Vertical SaaS concept around verifiable car history, trust scoring, and claims workflow.",
        image: "UTRA.png",
        kind: "hackathon",
        categories: ["fullstack", "web3"],
        links: {
          demo: "https://devpost.com/software/standard-hardware-challenge-autotrust",
          github: "https://github.com/PLIAN78/autotrust"
        },
        tags: ["Node", "MongoDB", "Product Design"]
      },
      {
        title: "Fantasy founders",
        subtitle: "Drafting for your nexr Tech Boom",
        desc: "Fantasy football for drafting tech foundrs and tech bros",
        image: "GH.png",
        kind: "hackathon",
        categories: ["fullstack","LLM"],
        links: {
          demo: "https://goon-hack-7oj42e1en-lianpeter1225-gmailcoms-projects.vercel.app/",
          github: "https://github.com/PLIAN78/GOONHack"
        },
        tags: ["Node", "MongoDB", "Product Design"]
      }
    ];

    function el(tag, attrs = {}, children = []) {
      const node = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs)) {
        if (k === "class") node.className = v;
        else if (k.startsWith("on") && typeof v === "function") node.addEventListener(k.slice(2), v);
        else if (k === "html") node.innerHTML = v;
        else node.setAttribute(k, v);
      }
      for (const ch of children) node.appendChild(typeof ch === "string" ? document.createTextNode(ch) : ch);
      return node;
    }

    function logoNode(src, alt) {
      const wrapClass = src ? "logo-wrap" : "logo-wrap placeholder";
      const wrap = el("div", { class: wrapClass, "aria-hidden": "true" }, []);
      if (src) wrap.appendChild(el("img", { src, alt: alt || "logo" }, []));
      return wrap;
    }

    function buildCard({ title, subtitle, desc, image, tags = [], actions = [], metaText = "" }) {
      return el("div", { class: "project-card" }, [
        el("div", { class: "project-top" }, [
          logoNode(image, title + " logo"),
          el("div", {}, [
            el("div", { class: "project-title" }, [title]),
            el("div", { class: "project-sub" }, [subtitle + (metaText ? (" ¬∑ " + metaText) : "")]),
          ])
        ]),
        el("div", { class: "project-desc" }, [desc]),
        el("div", { class: "tags" }, (tags || []).map(t => el("span", { class: "tag" }, [t]))),
        el("div", { class: "project-actions" }, actions)
      ]);
    }

    function renderCareer({ filter = "all", query = "" } = {}) {
      const grid = document.getElementById("careerGrid");
      if (!grid) return;
      grid.innerHTML = "";

      const q = query.trim().toLowerCase();

      const filtered = careers.filter(c => {
        const matchesFilter =
          filter === "all" ||
          (filter === "current" && c.status === "current") ||
          (filter === "past" && c.status === "past") ||
          (c.categories || []).includes(filter);

        const hay = [
          c.title, c.subtitle, c.desc,
          (c.tags || []).join(" "),
          (c.categories || []).join(" "),
          c.status, c.when
        ].join(" ").toLowerCase();

        const matchesQuery = !q || hay.includes(q);
        return matchesFilter && matchesQuery;
      });

      filtered.forEach(c => {
        const href = c.href || "https://www.linkedin.com/in/yishuolian/";
        const actions = [
          el("a", { class: "btn primary", href, target: "_blank", rel: "noreferrer" }, [
            el("i", { class: "fa-solid fa-arrow-up-right-from-square", "aria-hidden":"true" }),
            "Open"
          ])
        ];

        grid.appendChild(buildCard({
          title: c.title,
          subtitle: c.subtitle,
          desc: c.desc,
          image: c.image,
          tags: c.tags || [],
          actions,
          metaText: c.when || ""
        }));
      });

      if (filtered.length === 0) {
        grid.appendChild(
          el("div", { class: "project-card", style: "grid-column: 1 / -1; text-align:center;" }, [
            el("div", { class: "project-title" }, ["No matches"]),
            el("div", { class: "project-sub" }, ["Try a different filter or search term."])
          ])
        );
      }
    }

    function renderSideHustles() {
      const grid = document.getElementById("startupGrid");
      if (!grid) return;
      grid.innerHTML = "";

      startupProjects.forEach(p => {
        const actions = [
          el("a", { class: "btn primary", href: p.href, target: "_blank", rel: "noreferrer" }, [
            el("i", { class: "fa-solid fa-arrow-up-right-from-square", "aria-hidden":"true" }),
            "Open"
          ])
        ];

        grid.appendChild(buildCard({
          title: p.title,
          subtitle: p.subtitle,
          desc: p.desc,
          image: p.image,
          tags: p.tags || [],
          actions
        }));
      });
    }

    function renderProjects({ filter = "all", query = "" } = {}) {
      const grid = document.getElementById("projectGrid");
      if (!grid) return;
      grid.innerHTML = "";

      const q = query.trim().toLowerCase();

      const filtered = projects.filter(p => {
        const matchesFilter =
          filter === "all" ||
          (filter === "hackathon" && p.kind === "hackathon") ||
          (filter === "personal" && p.kind === "personal") ||
          (p.categories || []).includes(filter);

        const hay = [
          p.title, p.subtitle, p.desc,
          (p.tags || []).join(" "),
          (p.categories || []).join(" "),
          p.kind
        ].join(" ").toLowerCase();

        const matchesQuery = !q || hay.includes(q);
        return matchesFilter && matchesQuery;
      });

      filtered.forEach(p => {
        const actions = [];

        const demoHref = (p.links && p.links.demo) ? p.links.demo : (p.links && p.links.github ? p.links.github : "https://github.com/PLIAN78");
        actions.push(
          el("a", { class: "btn primary", href: demoHref, target: "_blank", rel: "noreferrer" }, [
            el("i", { class: "fa-solid fa-play", "aria-hidden":"true" }),
            "Demo"
          ])
        );

        if (p.links?.github) {
          actions.push(
            el("a", { class: "btn", href: p.links.github, target: "_blank", rel: "noreferrer" }, [
              el("i", { class: "fa-brands fa-github", "aria-hidden":"true" }),
              "GitHub"
            ])
          );
        }

        const categoryTags = (p.categories || []).map(c => (String(c).toUpperCase()));
        const allTags = [...(p.tags || []), ...categoryTags];

        grid.appendChild(buildCard({
          title: p.title,
          subtitle: p.subtitle,
          desc: p.desc,
          image: p.image,
          tags: allTags,
          actions,
          metaText: (p.kind === "hackathon" ? "Hackathon" : "Personal")
        }));
      });

      if (filtered.length === 0) {
        grid.appendChild(
          el("div", { class: "project-card", style: "grid-column: 1 / -1; text-align:center;" }, [
            el("div", { class: "project-title" }, ["No matches"]),
            el("div", { class: "project-sub" }, ["Try a different filter or search term."])
          ])
        );
      }
    }

    (function setup() {
      renderCareer({ filter: "all", query: "" });
      renderSideHustles();
      renderProjects({ filter: "all", query: "" });

      const careerChips = Array.from(document.querySelectorAll(".chip[data-career-filter]"));
      const careerInput = document.getElementById("careerSearchInput");
      let activeCareerFilter = "all";

      careerChips.forEach(chip => {
        chip.addEventListener("click", () => {
          careerChips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          activeCareerFilter = chip.getAttribute("data-career-filter") || "all";
          renderCareer({ filter: activeCareerFilter, query: careerInput?.value || "" });
        });
      });

      careerInput?.addEventListener("input", () => {
        renderCareer({ filter: activeCareerFilter, query: careerInput.value || "" });
      });

      const projectChips = Array.from(document.querySelectorAll(".chip[data-filter]"));
      const projectInput = document.getElementById("searchInput");
      let activeProjectFilter = "all";

      projectChips.forEach(chip => {
        chip.addEventListener("click", () => {
          projectChips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          activeProjectFilter = chip.getAttribute("data-filter") || "all";
          renderProjects({ filter: activeProjectFilter, query: projectInput?.value || "" });
        });
      });

      projectInput?.addEventListener("input", () => {
        renderProjects({ filter: activeProjectFilter, query: projectInput.value || "" });
      });
    })();

    /* =======================
       FENCING MINI GAME LOGIC
       ======================= */
    (function fencingGame(){
      const canvas = document.getElementById("fenceCanvas");
      const ctx = canvas?.getContext("2d");
      if (!canvas || !ctx) return;

      const pScoreEl = document.getElementById("fgPScore");
      const aScoreEl = document.getElementById("fgAScore");
      const modeEl = document.getElementById("fgMode");
      const streakEl = document.getElementById("fgStreak");
      const logEl = document.getElementById("fgLog");
      const dotEl = document.getElementById("fgDot");

      const btnLunge = document.getElementById("fgLungeBtn");
      const btnParry = document.getElementById("fgParryBtn");
      const btnReset = document.getElementById("fgResetBtn");

      const S = {
        pScore:0, aScore:0, streak:0,
        phase:"idle", // idle | warning | parry_window | riposte_window | resolve | gameover
        warningAt:0,
        aiCommitAt:0,
        parryDeadline:0,
        riposteDeadline:0,

        pX:260, aX:940,
        pArm:0, aArm:0,
        pLunge:0, aLunge:0,
        parryArmed:false,
      };

      function rand(min,max){ return Math.random()*(max-min)+min; }

      function setMode(t){ modeEl.textContent = t; }
      function setDot(tone){
        dotEl.className = "fence-dot" + (tone==="good"?" ok":tone==="warn"?" warn":tone==="bad"?" bad":"");
      }
      function setLog(html, tone="neutral"){
        logEl.innerHTML = html;
        setDot(tone==="neutral" ? "" : tone);
      }

      function resetRound(msg="En garde‚Ä¶ watch Red."){
        S.phase = "idle";
        S.parryArmed = false;
        S.pArm=0; S.aArm=0;
        S.pLunge=0; S.aLunge=0;

        const now = performance.now();
        const think = rand(650, 1250);
        const willAttack = Math.random() < 0.55;
        S.warningAt = now + think;
        S.aiCommitAt = willAttack ? S.warningAt + rand(450, 950) : Infinity;

        setMode("Ready");
        setLog(msg, "neutral");
      }

      function hardReset(){
        S.pScore=0; S.aScore=0; S.streak=0;
        pScoreEl.textContent="0";
        aScoreEl.textContent="0";
        streakEl.textContent="0";
        setMode("Ready");
        setLog(`Press <span class="fence-kbd">Space</span> to lunge. If Red commits, parry <span class="fence-kbd">F</span> then riposte with <span class="fence-kbd">Space</span>.`, "neutral");
        resetRound("");
      }

      function endGame(){
        S.phase="gameover";
        setMode("Game Over");
        const win = S.pScore > S.aScore;
        setLog(win ? `üèÜ You win ${S.pScore}-${S.aScore}.` : `üíÄ AI wins ${S.aScore}-${S.pScore}.`, win ? "good" : "bad");
      }

      function scorePoint(who){
        if (who==="player"){ S.pScore++; S.streak++; }
        else { S.aScore++; S.streak=0; }

        pScoreEl.textContent = String(S.pScore);
        aScoreEl.textContent = String(S.aScore);
        streakEl.textContent = String(S.streak);

        if (S.pScore>=5 || S.aScore>=5) endGame();
        else resetRound("");
      }

      function onParry(){
        if (S.phase !== "parry_window") {
          setLog(`Parry only when Red commits.`, "warn");
          return;
        }
        const now = performance.now();
        if (now <= S.parryDeadline) {
          S.parryArmed = true;
          S.phase = "riposte_window";
          S.riposteDeadline = now + 800;
          S.pArm = 1;
          setMode("Riposte!");
          setLog(`Nice parry. Riposte with <span class="fence-kbd">Space</span>!`, "good");
        } else {
          S.phase = "resolve";
          setMode("Hit");
          S.aLunge = 1;
          setLog(`Too late ‚Äî Red hits.`, "bad");
          setTimeout(() => scorePoint("ai"), 420);
        }
      }

      function onLunge(){
        if (S.phase === "gameover") return;

        const now = performance.now();

        // riposte
        if (S.phase === "riposte_window") {
          if (now <= S.riposteDeadline) {
            S.phase="resolve";
            S.pLunge=1;
            setMode("Touch!");
            setLog(`Clean riposte ‚Äî touch!`, "good");
            setTimeout(() => scorePoint("player"), 420);
          } else {
            S.phase="resolve";
            setMode("Missed");
            setLog(`Riposte window missed ‚Äî Red recovers.`, "bad");
            setTimeout(() => scorePoint("ai"), 420);
          }
          return;
        }

        // if AI is attacking and you didn't parry
        if (S.phase === "parry_window") {
          S.phase="resolve";
          S.pLunge=1; S.aLunge=1;
          setMode("Hit");
          setLog(`Red was committing ‚Äî you get hit.`, "bad");
          setTimeout(() => scorePoint("ai"), 420);
          return;
        }

        const dangerSoon = (S.aiCommitAt - now) < 220;

        if (S.aiCommitAt !== Infinity && now >= S.aiCommitAt - 200 && now <= S.aiCommitAt + 120) {
          S.phase="resolve";
          S.pLunge=1; S.aLunge=1;
          setMode("Countered");
          setLog(`You lunged into Red‚Äôs timing ‚Äî counter-touch.`, "bad");
          setTimeout(() => scorePoint("ai"), 420);
          return;
        }

        if (dangerSoon) {
          const win = Math.random() < 0.35;
          S.phase="resolve";
          S.pLunge=1; S.aLunge=0.85;
          if (win) {
            setMode("Touch!");
            setLog(`Bold lunge ‚Äî you sneak the touch.`, "good");
            setTimeout(() => scorePoint("player"), 420);
          } else {
            setMode("Stopped");
            setLog(`Red reads it ‚Äî you get stopped.`, "bad");
            setTimeout(() => scorePoint("ai"), 420);
          }
          return;
        }

        const win = Math.random() < 0.62;
        S.phase="resolve";
        S.pLunge=1;
        if (win) {
          setMode("Touch!");
          setLog(`Nice timing ‚Äî touch!`, "good");
          setTimeout(() => scorePoint("player"), 420);
        } else {
          setMode("Parried");
          S.aArm=1;
          setLog(`Red parries your attack.`, "bad");
          setTimeout(() => scorePoint("ai"), 420);
        }
      }

      function roundRect(x,y,w,h,r){
        const rr = Math.min(r, w/2, h/2);
        ctx.beginPath();
        ctx.moveTo(x+rr, y);
        ctx.lineTo(x+w-rr, y);
        ctx.quadraticCurveTo(x+w, y, x+w, y+rr);
        ctx.lineTo(x+w, y+h-rr);
        ctx.quadraticCurveTo(x+w, y+h, x+w-rr, y+h);
        ctx.lineTo(x+rr, y+h);
        ctx.quadraticCurveTo(x, y+h, x, y+h-rr);
        ctx.lineTo(x, y+rr);
        ctx.quadraticCurveTo(x, y, x+rr, y);
        ctx.closePath();
      }

      function drawFencer(x, y, dir, bodyRGBA, armRaise01){
        ctx.save();
        ctx.translate(x, y);

        // feet
        ctx.fillStyle = "rgba(13,38,48,0.18)";
        ctx.fillRect(-40*dir, -6, 40*dir, 10);
        ctx.fillRect(10*dir, -6, 42*dir, 10);

        // legs
        ctx.strokeStyle = "rgba(13,38,48,0.18)";
        ctx.lineWidth = 10;
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(-10*dir, -6);
        ctx.lineTo(-22*dir, -48);
        ctx.lineTo(-4*dir, -92);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(10*dir, -6);
        ctx.lineTo(28*dir, -54);
        ctx.lineTo(8*dir, -98);
        ctx.stroke();

        // torso
        ctx.fillStyle = bodyRGBA;
        roundRect(-26, -160, 52, 86, 18);
        ctx.fill();

        // mask
        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.beginPath();
        ctx.arc(0, -182, 26, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "rgba(0,0,0,0.35)";
        ctx.beginPath();
        ctx.arc(6*dir, -182, 16, -0.2, Math.PI*2-0.2);
        ctx.fill();

        // arm
        ctx.strokeStyle = "rgba(13,38,48,0.55)";
        ctx.lineWidth = 10;
        ctx.lineCap = "round";
        const armRaise = armRaise01 * 24;
        ctx.beginPath();
        ctx.moveTo(12*dir, -140);
        ctx.lineTo(48*dir, -132 - armRaise);
        ctx.stroke();

        ctx.restore();
      }

      function drawBlade(x, y, dir, armRaise01, bladeRGBA){
        ctx.save();
        ctx.translate(x, y);

        const armRaise = armRaise01 * 24;
        const x0 = 48*dir;
        const y0 = -132 - armRaise;

        ctx.strokeStyle = bladeRGBA;
        ctx.lineWidth = 5;
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(x0, y0);
        ctx.lineTo(x0 + 220*dir, y0 - 24);
        ctx.stroke();

        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.beginPath();
        ctx.arc(x0 + 220*dir, y0 - 24, 6, 0, Math.PI*2);
        ctx.fill();

        ctx.restore();
      }

      function draw(){
        const w = canvas.width, h = canvas.height;
        ctx.clearRect(0,0,w,h);

        // piste
        const baseY = h*0.62;
        ctx.fillStyle = "rgba(13,38,48,0.10)";
        ctx.fillRect(0, baseY, w, 6);

        // center
        ctx.fillStyle = "rgba(13,38,48,0.10)";
        ctx.fillRect(w/2 - 2, h*0.52, 4, h*0.24);

        const pX = S.pX + S.pLunge * 90;
        const aX = S.aX - S.aLunge * 90;

        // fighters
        drawFencer(pX, baseY, 1, "rgba(38,186,215,0.95)", S.pArm);
        drawFencer(aX, baseY, -1, "rgba(255,77,109,0.90)", S.aArm);

        // blades
        drawBlade(pX, baseY, 1, S.pArm, "rgba(38,186,215,0.75)");
        drawBlade(aX, baseY, -1, S.aArm, "rgba(255,77,109,0.65)");

        // small overlay hint
        ctx.globalAlpha = 0.92;
        ctx.fillStyle = "rgba(255,255,255,0.65)";
        ctx.fillRect(18, 18, 520, 70);
        ctx.globalAlpha = 1;
        ctx.fillStyle = "rgba(13,38,48,0.92)";
        ctx.font = "28px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText("Space: Lunge / Riposte    F: Parry", 36, 58);
      }

      function tick(){
        const now = performance.now();

        if (S.phase !== "gameover") {
          if (S.phase === "idle" && now >= S.warningAt) {
            S.phase = "warning";
            setMode("Watch");
            setLog(`Red is twitchy‚Ä¶`, "warn");
          }

          if ((S.phase === "warning" || S.phase === "idle") && now >= S.aiCommitAt) {
            S.phase = "parry_window";
            S.parryDeadline = now + 440;
            setMode("Parry!");
            setLog(`Red commits ‚Äî parry with <span class="fence-kbd">F</span>!`, "warn");
            S.aLunge = 1;
          }

          // if they committed and you did nothing
          if (S.phase === "parry_window" && now > S.parryDeadline) {
            S.phase = "resolve";
            setMode("Hit");
            setLog(`No parry ‚Äî Red hits.`, "bad");
            setTimeout(() => scorePoint("ai"), 420);
          }

          // decay anim
          S.pLunge *= 0.90;
          S.aLunge *= 0.90;
          S.pArm *= 0.88;
          S.aArm *= 0.88;
        }

        draw();
        requestAnimationFrame(tick);
      }

      // events
      window.addEventListener("keydown", (e) => {
        if (e.code === "Space") { e.preventDefault(); onLunge(); }
        if (e.key.toLowerCase() === "f") { onParry(); }
      });
      btnLunge?.addEventListener("click", onLunge);
      btnParry?.addEventListener("click", onParry);
      btnReset?.addEventListener("click", hardReset);

      hardReset();
      requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>
